<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The Sparta Modeling Framework: sparta::SpartaSharedPointerAllocator&lt; PointerT &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">The Sparta Modeling Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('classsparta_1_1SpartaSharedPointerAllocator.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="classsparta_1_1SpartaSharedPointerAllocator-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">sparta::SpartaSharedPointerAllocator&lt; PointerT &gt; Class Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A memory allocator complementing <a class="el" href="classsparta_1_1SpartaSharedPointer.html" title="Used for garbage collection, will delete the object it points to when all objects are finished using ...">SpartaSharedPointer</a> that reuses old memory.  
 <a href="classsparta_1_1SpartaSharedPointerAllocator.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html">SpartaSharedPointerAllocator.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for sparta::SpartaSharedPointerAllocator&lt; PointerT &gt;:</div>
<div class="dyncontent">
<div class="center"><img src="classsparta_1_1SpartaSharedPointerAllocator__inherit__graph.png" border="0" usemap="#asparta_1_1SpartaSharedPointerAllocator_3_01PointerT_01_4_inherit__map" alt="Inheritance graph"/></div>
<map name="asparta_1_1SpartaSharedPointerAllocator_3_01PointerT_01_4_inherit__map" id="asparta_1_1SpartaSharedPointerAllocator_3_01PointerT_01_4_inherit__map">
<area shape="rect" title="A memory allocator complementing SpartaSharedPointer that reuses old memory." alt="" coords="5,80,189,121"/>
<area shape="rect" title=" " alt="" coords="46,5,149,32"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for sparta::SpartaSharedPointerAllocator&lt; PointerT &gt;:</div>
<div class="dyncontent">
<div class="center"><img src="classsparta_1_1SpartaSharedPointerAllocator__coll__graph.png" border="0" usemap="#asparta_1_1SpartaSharedPointerAllocator_3_01PointerT_01_4_coll__map" alt="Collaboration graph"/></div>
<map name="asparta_1_1SpartaSharedPointerAllocator_3_01PointerT_01_4_coll__map" id="asparta_1_1SpartaSharedPointerAllocator_3_01PointerT_01_4_coll__map">
<area shape="rect" title="A memory allocator complementing SpartaSharedPointer that reuses old memory." alt="" coords="5,80,189,121"/>
<area shape="rect" title=" " alt="" coords="46,5,149,32"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:aecc4b3c3f1641919eae72895eec68795"><td class="memItemLeft" align="right" valign="top"><a id="aecc4b3c3f1641919eae72895eec68795"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#aecc4b3c3f1641919eae72895eec68795">element_type</a> = PointerT</td></tr>
<tr class="memdesc:aecc4b3c3f1641919eae72895eec68795"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handy typedef. <br /></td></tr>
<tr class="separator:aecc4b3c3f1641919eae72895eec68795"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85e059a11a23bcd39d29b27eb369a260"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#a85e059a11a23bcd39d29b27eb369a260">WaterMarkWarningCallback</a> = std::function&lt; void(const <a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">SpartaSharedPointerAllocator</a> &amp;)&gt;</td></tr>
<tr class="separator:a85e059a11a23bcd39d29b27eb369a260"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:af6b9ba67f6eefd3b2c0029f1e6a467b5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#af6b9ba67f6eefd3b2c0029f1e6a467b5">SpartaSharedPointerAllocator</a> (const size_t max_num_blocks, const size_t water_mark)</td></tr>
<tr class="memdesc:af6b9ba67f6eefd3b2c0029f1e6a467b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct this allocator with num_blocks of initial memory.  <a href="classsparta_1_1SpartaSharedPointerAllocator.html#af6b9ba67f6eefd3b2c0029f1e6a467b5">More...</a><br /></td></tr>
<tr class="separator:af6b9ba67f6eefd3b2c0029f1e6a467b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c6f1315062f71f63b57b75d9ca367d4"><td class="memItemLeft" align="right" valign="top"><a id="a2c6f1315062f71f63b57b75d9ca367d4"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#a2c6f1315062f71f63b57b75d9ca367d4">SpartaSharedPointerAllocator</a> (const <a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">SpartaSharedPointerAllocator</a> &amp;)=delete</td></tr>
<tr class="memdesc:a2c6f1315062f71f63b57b75d9ca367d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disallow copies/assignments/moves. <br /></td></tr>
<tr class="separator:a2c6f1315062f71f63b57b75d9ca367d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ba7048444221fc4a7b4dc8a2bbc188e"><td class="memItemLeft" align="right" valign="top"><a id="a6ba7048444221fc4a7b4dc8a2bbc188e"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#a6ba7048444221fc4a7b4dc8a2bbc188e">SpartaSharedPointerAllocator</a> (<a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">SpartaSharedPointerAllocator</a> &amp;&amp;)=delete</td></tr>
<tr class="memdesc:a6ba7048444221fc4a7b4dc8a2bbc188e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disallow copies/assignments/moves. <br /></td></tr>
<tr class="separator:a6ba7048444221fc4a7b4dc8a2bbc188e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeee6213681229ec8e916c4038838c7a3"><td class="memItemLeft" align="right" valign="top"><a id="aeee6213681229ec8e916c4038838c7a3"></a>
<a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">SpartaSharedPointerAllocator</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#aeee6213681229ec8e916c4038838c7a3">operator=</a> (const <a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">SpartaSharedPointerAllocator</a> &amp;)=delete</td></tr>
<tr class="memdesc:aeee6213681229ec8e916c4038838c7a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disallow copies/assignments/moves. <br /></td></tr>
<tr class="separator:aeee6213681229ec8e916c4038838c7a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee6419fc295fe147808c0ca74d367a54"><td class="memItemLeft" align="right" valign="top"><a id="aee6419fc295fe147808c0ca74d367a54"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#aee6419fc295fe147808c0ca74d367a54">~SpartaSharedPointerAllocator</a> ()</td></tr>
<tr class="memdesc:aee6419fc295fe147808c0ca74d367a54"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clean up the allocator &ndash; will warn if there are objects not returned to the allocator. <br /></td></tr>
<tr class="separator:aee6419fc295fe147808c0ca74d367a54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf9cc226875342cd3e92e454d276077a"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#acf9cc226875342cd3e92e454d276077a">getNumFree</a> () const</td></tr>
<tr class="memdesc:acf9cc226875342cd3e92e454d276077a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the number of freed objects this allocator holds.  <a href="classsparta_1_1SpartaSharedPointerAllocator.html#acf9cc226875342cd3e92e454d276077a">More...</a><br /></td></tr>
<tr class="separator:acf9cc226875342cd3e92e454d276077a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf47462ef900573a40096a3e8895e85e"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#acf47462ef900573a40096a3e8895e85e">getNumAllocated</a> () const</td></tr>
<tr class="memdesc:acf47462ef900573a40096a3e8895e85e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the number of allocated objects this allocator allocated over time.  <a href="classsparta_1_1SpartaSharedPointerAllocator.html#acf47462ef900573a40096a3e8895e85e">More...</a><br /></td></tr>
<tr class="separator:acf47462ef900573a40096a3e8895e85e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2722e90894851fb3826657172c997cb3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#a2722e90894851fb3826657172c997cb3">hasOutstandingObjects</a> () const</td></tr>
<tr class="memdesc:a2722e90894851fb3826657172c997cb3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Query to see if the allocator has any outstanding memory not yet returned.  <a href="classsparta_1_1SpartaSharedPointerAllocator.html#a2722e90894851fb3826657172c997cb3">More...</a><br /></td></tr>
<tr class="separator:a2722e90894851fb3826657172c997cb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc52c9cabcf7996791487480e50a6edd"><td class="memItemLeft" align="right" valign="top">std::vector&lt; const PointerT * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#abc52c9cabcf7996791487480e50a6edd">getOutstandingAllocatedObjects</a> () const</td></tr>
<tr class="memdesc:abc52c9cabcf7996791487480e50a6edd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return a vector of objects that have not been deleted/not yet returned to the allocator.  <a href="classsparta_1_1SpartaSharedPointerAllocator.html#abc52c9cabcf7996791487480e50a6edd">More...</a><br /></td></tr>
<tr class="separator:abc52c9cabcf7996791487480e50a6edd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98f7d3864319e19258e68dc7cb58eb48"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#a98f7d3864319e19258e68dc7cb58eb48">registerCustomWaterMarkCallback</a> (const <a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#a85e059a11a23bcd39d29b27eb369a260">WaterMarkWarningCallback</a> &amp;callback)</td></tr>
<tr class="memdesc:a98f7d3864319e19258e68dc7cb58eb48"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set a custom watermark callback.  <a href="classsparta_1_1SpartaSharedPointerAllocator.html#a98f7d3864319e19258e68dc7cb58eb48">More...</a><br /></td></tr>
<tr class="separator:a98f7d3864319e19258e68dc7cb58eb48"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:a0dee324e37b41dd1dfe271b801f5765a"><td class="memItemLeft" align="right" valign="top"><a id="a0dee324e37b41dd1dfe271b801f5765a"></a>
class&#160;</td><td class="memItemRight" valign="bottom"><b>SpartaSharedPointer&lt; PointerT &gt;</b></td></tr>
<tr class="separator:a0dee324e37b41dd1dfe271b801f5765a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac153c9e63de4e106028abbd7a1f777ba"><td class="memTemplParams" colspan="2"><a id="ac153c9e63de4e106028abbd7a1f777ba"></a>
template&lt;typename PtrT , typename... Args&gt; </td></tr>
<tr class="memitem:ac153c9e63de4e106028abbd7a1f777ba"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="classsparta_1_1SpartaSharedPointer.html">SpartaSharedPointer</a>&lt; PtrT &gt;&#160;</td><td class="memTemplItemRight" valign="bottom"><b>allocate_sparta_shared_pointer</b> (<a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">SpartaSharedPointerAllocator</a>&lt; PtrT &gt; &amp;, Args &amp;&amp;...args)</td></tr>
<tr class="separator:ac153c9e63de4e106028abbd7a1f777ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;class PointerT&gt;<br />
class sparta::SpartaSharedPointerAllocator&lt; PointerT &gt;</h3>

<p>A memory allocator complementing <a class="el" href="classsparta_1_1SpartaSharedPointer.html" title="Used for garbage collection, will delete the object it points to when all objects are finished using ...">SpartaSharedPointer</a> that reuses old memory. </p>
<p>First off, this allocator <em>DOES NOT</em> follow the semantics of std::allocator_traits. This is done on purpose to prevent others from using this class with std types like std::shared_ptr, std::vector, etc. Also, this class <em>is not</em> thread safe. Do not expect it to work in a threaded application where multiple threads are allocating/deallocating with the same sparta::SpartaSharedPointerAllocator&lt;PointerT&gt; instance.</p>
<p>Also, the allocator <em>must outlive</em> any simulator componentry that uses objects allocated by this allocator. If not, random seg faults will plague the developer. Suggested use is to make this allocator global, with user-defined atomic operations if desired.</p>
<p>Another suggestion for Sparta developers using these allocators is to create an <code>Allocator</code> class type that derives from <a class="el" href="classsparta_1_1TreeNode.html" title="Node in a composite tree representing a sparta Tree item.">sparta::TreeNode</a> and place that class somewhere in the simulation under root:</p>
<div class="fragment"><div class="line"><span class="comment">// Define a specific TreeNode that is just allocators</span></div>
<div class="line"><span class="keyword">class </span>OurAllocators : <span class="keyword">public</span> <a class="code" href="classsparta_1_1TreeNode.html">sparta::TreeNode</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">     <span class="comment">// Constructors and what-not...</span></div>
<div class="line"> </div>
<div class="line">     <span class="comment">// Allocators</span></div>
<div class="line">     <span class="keyword">using</span> MyAllocator = <a class="code" href="classsparta_1_1SpartaSharedPointerAllocator.html">sparta::SpartaSharedPointerAllocator&lt;MyClassIUseALot&gt;</a>;</div>
<div class="line">     MyAllocator my_allocator(100, 200);  <span class="comment">// whatever params you chose</span></div>
<div class="line">};</div>
<div class="ttc" id="aclasssparta_1_1SpartaSharedPointerAllocator_html"><div class="ttname"><a href="classsparta_1_1SpartaSharedPointerAllocator.html">sparta::SpartaSharedPointerAllocator</a></div><div class="ttdoc">A memory allocator complementing SpartaSharedPointer that reuses old memory.</div><div class="ttdef"><b>Definition:</b> <a href="SpartaSharedPointerAllocator_8hpp_source.html#l00154">SpartaSharedPointerAllocator.hpp:155</a></div></div>
<div class="ttc" id="aclasssparta_1_1TreeNode_html"><div class="ttname"><a href="classsparta_1_1TreeNode.html">sparta::TreeNode</a></div><div class="ttdoc">Node in a composite tree representing a sparta Tree item.</div><div class="ttdef"><b>Definition:</b> <a href="TreeNode_8hpp_source.html#l00204">TreeNode.hpp:205</a></div></div>
</div><!-- fragment --><p>And in the modeler's block, they would retrive the <code>OurAllocators</code> node and get the allocator:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyDevice : <span class="keyword">public</span> <a class="code" href="classsparta_1_1Unit.html">sparta::Unit</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    MyDevice(<a class="code" href="classsparta_1_1TreeNode.html">sparta::TreeNode</a> * my_container, <a class="code" href="classsparta_1_1ParameterSet.html">sparta::ParameterSet</a> *) :</div>
<div class="line">        my_allocator_(customUtilToFindTheAllocatorTreeNode(my_container)-&gt;my_allocator)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"> </div>
<div class="line">    OurAllocators::MyAllocator &amp; my_allocator_;</div>
<div class="line">};</div>
<div class="ttc" id="aclasssparta_1_1ParameterSet_html"><div class="ttname"><a href="classsparta_1_1ParameterSet.html">sparta::ParameterSet</a></div><div class="ttdoc">Generic container of Parameters.</div><div class="ttdef"><b>Definition:</b> <a href="ParameterSet_8hpp_source.html#l00064">ParameterSet.hpp:65</a></div></div>
<div class="ttc" id="aclasssparta_1_1Unit_html"><div class="ttname"><a href="classsparta_1_1Unit.html">sparta::Unit</a></div><div class="ttdoc">The is the base class for user defined blocks in simulation.</div><div class="ttdef"><b>Definition:</b> <a href="Unit_8hpp_source.html#l00037">Unit.hpp:38</a></div></div>
</div><!-- fragment --><p>The class is not intended to be used directly, but rather in compliment with the allocator method <a class="el" href="namespacesparta.html#a9cd013a78e68e9a0078d9471a52da749" title="Allocate a SpartaSharedPointer.">sparta::allocate_sparta_shared_pointer</a>.</p>
<p>A typical use of this class is when a modeler is creating/destroying lots and lots and lots of little objects throughout simulation. Using the std::allocator or boost::pool_allocator does help, but not as much as this allocator, which is tuned/focused on the exact modeling use case.</p>
<p>As an example of a healthy performance uplift, the CoreExample saw a 20% boost in performance using this allocation coupled with the <a class="el" href="classsparta_1_1SpartaSharedPointer.html" title="Used for garbage collection, will delete the object it points to when all objects are finished using ...">SpartaSharedPointer</a> over using std::shared_ptr created via std::allocate_shared. See a performance example in the <a class="el" href="classsparta_1_1SpartaSharedPointer.html" title="Used for garbage collection, will delete the object it points to when all objects are finished using ...">SpartaSharedPointer</a> unit test.</p>
<p>To use this allocator, create a singleton of it in the application for the given type:</p>
<div class="fragment"><div class="line"><span class="comment">// .cpp file</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instance of the allocator in source.  Set it up to</span></div>
<div class="line"><span class="comment">// initially allocate 100 blocks of memory.</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>mysimulator {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> max_blocks_allowed = 100;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> water_mark_complaining_point = 80;</div>
<div class="line">    <a class="code" href="classsparta_1_1SpartaSharedPointerAllocator.html">sparta::SpartaSharedPointerAllocator&lt;MyClassIUseALot&gt;</a></div>
<div class="line">                                     my_class_i_use_a_lot_allocator(max_blocks_allowed,</div>
<div class="line">                                                                    water_mark_complaining_point);</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">namespace </span>mysimulator {</div>
<div class="line">    <span class="comment">// .hpp file</span></div>
<div class="line">    <span class="keyword">class </span>MyClassIUseALot</div>
<div class="line">    {</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        <span class="comment">// Constructor with two args</span></div>
<div class="line">        MyClassIUseALot(uint32_t, <span class="keyword">const</span> std::string&amp;);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// The Allocator to use with the class</span></div>
<div class="line">    <span class="keyword">extern</span> <a class="code" href="classsparta_1_1SpartaSharedPointerAllocator.html">sparta::SpartaSharedPointerAllocator&lt;MyClassIUseALot&gt;</a></div>
<div class="line">                                      my_class_i_use_a_lot_allocator;</div>
<div class="line">}</div>
</div><!-- fragment --><p>In runtime code, use allocate_sparta_shared_pointer method to allocate instances of the <a class="el" href="classsparta_1_1SpartaSharedPointer.html" title="Used for garbage collection, will delete the object it points to when all objects are finished using ...">SpartaSharedPointer</a>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="classsparta_1_1SpartaSharedPointer.html">sparta::SpartaSharedPointer&lt;MyClassIUseALot&gt;</a> ptr =</div>
<div class="line">        sparta::allocate_sparta_shared_pointer&lt;MyClassIUseALot&gt;(my_class_i_use_a_lot_allocator,</div>
<div class="line">                                                                30, <span class="stringliteral">&quot;hello&quot;</span>);</div>
<div class="line">    ptr.<a class="code" href="classsparta_1_1SpartaSharedPointer.html#af8c6b1b39ce97bf119c586d9a28984c1">reset</a>(); <span class="comment">// put back the allocated object in a pool</span></div>
<div class="line">}</div>
<div class="ttc" id="aclasssparta_1_1SpartaSharedPointer_html"><div class="ttname"><a href="classsparta_1_1SpartaSharedPointer.html">sparta::SpartaSharedPointer</a></div><div class="ttdoc">Used for garbage collection, will delete the object it points to when all objects are finished using ...</div><div class="ttdef"><b>Definition:</b> <a href="SpartaSharedPointer_8hpp_source.html#l00080">SpartaSharedPointer.hpp:81</a></div></div>
<div class="ttc" id="aclasssparta_1_1SpartaSharedPointer_html_af8c6b1b39ce97bf119c586d9a28984c1"><div class="ttname"><a href="classsparta_1_1SpartaSharedPointer.html#af8c6b1b39ce97bf119c586d9a28984c1">sparta::SpartaSharedPointer::reset</a></div><div class="ttdeci">void reset(PointerT *p=nullptr)</div><div class="ttdoc">Reset this shared pointer.</div><div class="ttdef"><b>Definition:</b> <a href="SpartaSharedPointer_8hpp_source.html#l00279">SpartaSharedPointer.hpp:279</a></div></div>
</div><!-- fragment --><p>Use <a class="el" href="classsparta_1_1SpartaSharedPointer.html" title="Used for garbage collection, will delete the object it points to when all objects are finished using ...">sparta::SpartaSharedPointer</a> like a regular <a class="el" href="classsparta_1_1SpartaSharedPointer.html" title="Used for garbage collection, will delete the object it points to when all objects are finished using ...">sparta::SpartaSharedPointer</a>.</p>
<p>The allocator's constructor takes two arguments: a maximum number of blocks to allocate and a water mark. The maximum number of blocks is the hard upper limit of this allocator. Go beyond that and the allocator will throw an exception that it's "out of memory." If the allocator hits the watermark, it will warn that memory is dangerously close to being "used up." Watermark must be less than or equal to max_num_blocks.</p>
<p>The Allocator also keeps track of those objects in flight that have not returned to the allocator. Using the call to <a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#abc52c9cabcf7996791487480e50a6edd" title="Return a vector of objects that have not been deleted/not yet returned to the allocator.">SpartaSharedPointerAllocator&lt;PointerT&gt;::getOutstandingAllocatedObjects</a>, a modeler can determine which objects are still outstanding, where they might be, and help debug the situation. </p>

<p class="definition">Definition at line <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html#l00154">154</a> of file <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html">SpartaSharedPointerAllocator.hpp</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a id="a85e059a11a23bcd39d29b27eb369a260"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85e059a11a23bcd39d29b27eb369a260">&#9670;&nbsp;</a></span>WaterMarkWarningCallback</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PointerT &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">sparta::SpartaSharedPointerAllocator</a>&lt; PointerT &gt;::<a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#a85e059a11a23bcd39d29b27eb369a260">WaterMarkWarningCallback</a> =  std::function&lt;void (const <a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">SpartaSharedPointerAllocator</a> &amp;)&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Used for defining a custom watermark callback. Default is to print a warning </p>

<p class="definition">Definition at line <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html#l00163">163</a> of file <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html">SpartaSharedPointerAllocator.hpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="af6b9ba67f6eefd3b2c0029f1e6a467b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6b9ba67f6eefd3b2c0029f1e6a467b5">&#9670;&nbsp;</a></span>SpartaSharedPointerAllocator()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PointerT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">sparta::SpartaSharedPointerAllocator</a>&lt; PointerT &gt;::<a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">SpartaSharedPointerAllocator</a> </td>
          <td>(</td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>max_num_blocks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>water_mark</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Construct this allocator with num_blocks of initial memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">max_num_blocks</td><td>The maximum number of blocks this allocator is allowed to use </td></tr>
    <tr><td class="paramname">water_mark</td><td>The point where this allocator will warn (once) if allocation passes this threshold</td></tr>
  </table>
  </dd>
</dl>
<p>Allocate a <a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html" title="A memory allocator complementing SpartaSharedPointer that reuses old memory.">SpartaSharedPointerAllocator</a> with a large block of memory (up front) to use during simulation for the PointerT type. The water_mark is a warning spot to help developers tune their allocations for their uses. </p>

<p class="definition">Definition at line <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html#l00176">176</a> of file <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html">SpartaSharedPointerAllocator.hpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="acf47462ef900573a40096a3e8895e85e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf47462ef900573a40096a3e8895e85e">&#9670;&nbsp;</a></span>getNumAllocated()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PointerT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t <a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">sparta::SpartaSharedPointerAllocator</a>&lt; PointerT &gt;::getNumAllocated </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the number of allocated objects this allocator allocated over time. </p>
<dl class="section return"><dt>Returns</dt><dd>Number of allocated objects</dd></dl>
<p>This count should always be &lt;= <a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#acf9cc226875342cd3e92e454d276077a" title="Return the number of freed objects this allocator holds.">getNumFree()</a> </p>

<p class="definition">Definition at line <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html#l00220">220</a> of file <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html">SpartaSharedPointerAllocator.hpp</a>.</p>

</div>
</div>
<a id="acf9cc226875342cd3e92e454d276077a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf9cc226875342cd3e92e454d276077a">&#9670;&nbsp;</a></span>getNumFree()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PointerT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t <a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">sparta::SpartaSharedPointerAllocator</a>&lt; PointerT &gt;::getNumFree </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the number of freed objects this allocator holds. </p>
<dl class="section return"><dt>Returns</dt><dd>Number of freed objects </dd></dl>

<p class="definition">Definition at line <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html#l00210">210</a> of file <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html">SpartaSharedPointerAllocator.hpp</a>.</p>

</div>
</div>
<a id="abc52c9cabcf7996791487480e50a6edd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc52c9cabcf7996791487480e50a6edd">&#9670;&nbsp;</a></span>getOutstandingAllocatedObjects()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PointerT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;const PointerT*&gt; <a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">sparta::SpartaSharedPointerAllocator</a>&lt; PointerT &gt;::getOutstandingAllocatedObjects </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return a vector of objects that have not been deleted/not yet returned to the allocator. </p>
<dl class="section return"><dt>Returns</dt><dd>vector of PointerT objects that still have reference counts &gt; 0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html#l00237">237</a> of file <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html">SpartaSharedPointerAllocator.hpp</a>.</p>

</div>
</div>
<a id="a2722e90894851fb3826657172c997cb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2722e90894851fb3826657172c997cb3">&#9670;&nbsp;</a></span>hasOutstandingObjects()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PointerT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">sparta::SpartaSharedPointerAllocator</a>&lt; PointerT &gt;::hasOutstandingObjects </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Query to see if the allocator has any outstanding memory not yet returned. </p>
<dl class="section return"><dt>Returns</dt><dd>True if there are outstanding blocks not yet returned to the allocator </dd></dl>

<p class="definition">Definition at line <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html#l00228">228</a> of file <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html">SpartaSharedPointerAllocator.hpp</a>.</p>

</div>
</div>
<a id="a98f7d3864319e19258e68dc7cb58eb48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98f7d3864319e19258e68dc7cb58eb48">&#9670;&nbsp;</a></span>registerCustomWaterMarkCallback()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class PointerT &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">sparta::SpartaSharedPointerAllocator</a>&lt; PointerT &gt;::registerCustomWaterMarkCallback </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html#a85e059a11a23bcd39d29b27eb369a260">WaterMarkWarningCallback</a> &amp;&#160;</td>
          <td class="paramname"><em>callback</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set a custom watermark callback. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">callback</td><td>The callback to use when the allocator hits the watermark</td></tr>
  </table>
  </dd>
</dl>
<p>The callback will be called only once after the watermark was hit. </p>

<p class="definition">Definition at line <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html#l00258">258</a> of file <a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html">SpartaSharedPointerAllocator.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/github/workspace/sparta/sparta/utils/<a class="el" href="SpartaSharedPointer_8hpp_source.html">SpartaSharedPointer.hpp</a></li>
<li>/github/workspace/sparta/sparta/utils/<a class="el" href="SpartaSharedPointerAllocator_8hpp_source.html">SpartaSharedPointerAllocator.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacesparta.html">sparta</a></li><li class="navelem"><a class="el" href="classsparta_1_1SpartaSharedPointerAllocator.html">SpartaSharedPointerAllocator</a></li>
    <li class="footer">Generated on Fri Sep 3 2021 23:35:51 for The Sparta Modeling Framework by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
